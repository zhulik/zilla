#!/usr/bin/env ruby
# frozen_string_literal: true

require "bundler/setup"
require "zilla"

require "irb"
require "irb/completion"

require "syntax_suggest"

class CLI
  def start_irb
    IRB.setup(nil)
    IRB.conf[:PROMPT][:DEFAULT] = { PROMPT_I: "%N(main):%03n:%i> ",
                                    PROMPT_N: "%N(main):%03n:%i> ",
                                    PROMPT_S: "%N(main):%03n:%i%l ",
                                    PROMPT_C: "%N(main):%03n:%i* ",
                                    RETURN: "=> %s\n" }
    workspace = IRB::WorkSpace.new(binding)
    irb = IRB::Irb.new(workspace)
    IRB.conf[:MAIN_CONTEXT] = irb.context
    irb.eval_input
  end
end

begin
  Sync do
    CLI.new.start_irb
  end
rescue Interrupt
  retry
end
